<!DOCTYPE html>
<html lang="en-gb">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Custom EQS Test | Agent Arachnids Anthology</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="EQS (Environment Query System) is a powerful tool when making an AI in Unreal Engine. Creating your own EQS Tests can open the way for more advanced interactions and more intelligent decision making.
In this tutorial, we will be making an EQS Test that can get a value from an actor using an interface.
EQS Test We will start by making a C&#43;&#43; Class:
Expand out the All Actors and search for EnvQueryTest">
    <meta name="generator" content="Hugo 0.133.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    
      <meta name="author" content = "Paul Brown">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/tutorials/custom-eqs-test/">
    

    <meta property="og:url" content="http://localhost:1313/tutorials/custom-eqs-test/">
  <meta property="og:site_name" content="Agent Arachnids Anthology">
  <meta property="og:title" content="Custom EQS Test">
  <meta property="og:description" content="EQS (Environment Query System) is a powerful tool when making an AI in Unreal Engine. Creating your own EQS Tests can open the way for more advanced interactions and more intelligent decision making.
In this tutorial, we will be making an EQS Test that can get a value from an actor using an interface.
EQS Test We will start by making a C&#43;&#43; Class:
Expand out the All Actors and search for EnvQueryTest">
  <meta property="og:locale" content="en_gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tutorials">
    <meta property="article:published_time" content="2023-05-16T14:19:16+01:00">
    <meta property="article:modified_time" content="2023-05-16T14:19:16+01:00">

  <meta itemprop="name" content="Custom EQS Test">
  <meta itemprop="description" content="EQS (Environment Query System) is a powerful tool when making an AI in Unreal Engine. Creating your own EQS Tests can open the way for more advanced interactions and more intelligent decision making.
In this tutorial, we will be making an EQS Test that can get a value from an actor using an interface.
EQS Test We will start by making a C&#43;&#43; Class:
Expand out the All Actors and search for EnvQueryTest">
  <meta itemprop="datePublished" content="2023-05-16T14:19:16+01:00">
  <meta itemprop="dateModified" content="2023-05-16T14:19:16+01:00">
  <meta itemprop="wordCount" content="671">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Custom EQS Test">
  <meta name="twitter:description" content="EQS (Environment Query System) is a powerful tool when making an AI in Unreal Engine. Creating your own EQS Tests can open the way for more advanced interactions and more intelligent decision making.
In this tutorial, we will be making an EQS Test that can get a value from an actor using an interface.
EQS Test We will start by making a C&#43;&#43; Class:
Expand out the All Actors and search for EnvQueryTest">

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Agent Arachnids Anthology
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/personal-projects/" title="Personal Projects page">
              Personal Projects
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/professional-projects/" title="Professional Projects page">
              Professional Projects
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/tutorials/" title="Tutorials page">
              Tutorials
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/university-projects/" title="University Projects page">
              University Projects
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Tutorials
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Custom EQS Test</h1>
      
      <p class="tracked">
        By <strong>Paul Brown</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2023-05-16T14:19:16+01:00">May 16, 2023</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>EQS (Environment Query System) is a powerful tool when making an AI in Unreal Engine. Creating your own EQS Tests can open the way
for more advanced interactions and more intelligent decision making.</p>
<p>In this tutorial, we will be making an EQS Test that can get a value from an actor using an interface.</p>
<h2 id="eqs-test">EQS Test</h2>
<p>We will start by making a C++ Class:</p>
<p>Expand out the All Actors and search for <code>EnvQueryTest</code></p>
<p>Place this Class wherever you would like in your project and open it up.</p>
<p>In the <strong>header (.h)</strong> file we will only need 2 functions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UEQ_PlayerScore();
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RunTest</span>(FEnvQueryInstance<span style="color:#f92672">&amp;</span> QueryInstance) <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span>;
</span></span></code></pre></div><p>We have here a constructor and a virtual function. Define these in the <strong>.cpp</strong> file and you should have this in that file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>UEQ_PlayerScore<span style="color:#f92672">::</span>UEQ_PlayerScore()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UEQ_PlayerScore<span style="color:#f92672">::</span>RunTest(FEnvQueryInstance<span style="color:#f92672">&amp;</span> QueryInstance) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The first thing that we need to define is what <code>Item</code> is going to be a valid type for this Test.</p>
<p>If you are wondering what an <code>Item</code> is, then it is basically what EQS spawns in and performs these Tests on to determine where
the final location is. They are created by the <a href="https://docs.unrealengine.com/5.1/en-US/eqs-node-reference-generators-in-unreal-engine/"><code>Generators</code></a>. There are essentially 2 types of item, Actor and Vector. We need to tell this test that we only care about the Actor base as we cannot run Interface functions on the Vectors.</p>
<p>To do this, we need a new include so at the top of the <strong>.cpp</strong> file, add:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;EnvironmentQuery/Items/EnvQueryItemType_ActorBase.h&#34;</span><span style="color:#75715e">
</span></span></span></code></pre></div><p>and in the constructor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>UEQ_PlayerScore<span style="color:#f92672">::</span>UEQ_PlayerScore()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ValidItemType <span style="color:#f92672">=</span> UEnvQueryItemType_ActorBase<span style="color:#f92672">::</span>StaticClass();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>That is all we need to do, so let&rsquo;s move onto the Test itself.</p>
<p>First we need to check if the Owner is valid so lets add that check to the <code>RunTest</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UEQ_PlayerScore<span style="color:#f92672">::</span>RunTest(FEnvQueryInstance<span style="color:#f92672">&amp;</span> QueryInstance) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//UDebugFunctionLibrary::DebugLog(&#34;Started Player Score Test&#34;, EDebugType::DT_Log);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	UObject<span style="color:#f92672">*</span> QueryOwner <span style="color:#f92672">=</span> QueryInstance.Owner.Get();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>IsValid(QueryOwner))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now that we know that the Query Owner is valid, we can bind the Min and Max threshold values. Add this after the if statement. We want this to run if it does <strong>NOT</strong> return.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>    FloatValueMin.BindData(QueryOwner, QueryInstance.QueryID);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> MinThresholdValue <span style="color:#f92672">=</span> FloatValueMin.GetValue();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	FloatValueMax.BindData(QueryOwner, QueryInstance.QueryID);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> MaxThresholdValue <span style="color:#f92672">=</span> FloatValueMax.GetValue();
</span></span></code></pre></div><p>And finally, we can iterate over the Items. We are going to be adding in the Item Iterator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (FEnvQueryInstance<span style="color:#f92672">::</span>ItemIterator It(<span style="color:#66d9ef">this</span>, QueryInstance); It; <span style="color:#f92672">++</span>It)
</span></span><span style="display:flex;"><span>	{		
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">float</span> PlayerScore <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		It.SetScore(TestPurpose, FilterType, PlayerScore, MinThresholdValue, MaxThresholdValue);
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><p>The SetScore function has a few overloads, but for setting it based on a float and 2 threshold values this is one to use.</p>
<h2 id="interface">Interface</h2>
<p>After we have the Test setup, we can move onto the interface that we will be trying to call on the item actors.</p>
<p>Scroll to the bottom of the Common Classes and you&rsquo;ll find the Unreal Interface. Call it whatever you&rsquo;d like and open it up. For this example, we will just make one function
that returns a float value. It is important to mark it as a BlueprintNativeEvent.</p>
<p>In the I(InterfaceName) class, add in:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UFUNCTION(BlueprintNativeEvent, BlueprintCallable)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> GetPlayerScore();
</span></span></code></pre></div><p>Your Interface <strong>.h</strong> file should look something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">// This class does not need to be modified.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>UINTERFACE(MinimalAPI)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UAI_Interface</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> UInterface
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	GENERATED_BODY()
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ARTIFICIALINTELLIGENCESYSTEM_API</span> IAI_Interface
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	GENERATED_BODY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Add interface functions to this class. This is the class that will be inherited to implement this interface.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UFUNCTION(BlueprintNativeEvent, BlueprintCallable, Category<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;AI Interface&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> GetPlayerScore();
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="putting-it-all-together">Putting it all together</h2>
<p>Returning to the EQS Test, we need to add to the Item Iterator to actually run the Interface call.</p>
<p>Add the following to the <code>for loop</code> after declaring <code>PlayerScore</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(AActor<span style="color:#f92672">*</span> ItemActor <span style="color:#f92672">=</span> GetItemActor(QueryInstance, It.GetIndex()))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        PlayerScore <span style="color:#f92672">=</span> IAI_Interface<span style="color:#f92672">::</span>Execute_GetPlayerScore(ItemActor);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>So your final C++ RunTest function should look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UEQ_PlayerScore<span style="color:#f92672">::</span>RunTest(FEnvQueryInstance<span style="color:#f92672">&amp;</span> QueryInstance) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{	
</span></span><span style="display:flex;"><span>   UObject<span style="color:#f92672">*</span> QueryOwner <span style="color:#f92672">=</span> QueryInstance.Owner.Get();
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>IsValid(QueryOwner))
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>   	<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   FloatValueMin.BindData(QueryOwner, QueryInstance.QueryID);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">float</span> MinThresholdValue <span style="color:#f92672">=</span> FloatValueMin.GetValue();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   FloatValueMax.BindData(QueryOwner, QueryInstance.QueryID);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">float</span> MaxThresholdValue <span style="color:#f92672">=</span> FloatValueMax.GetValue();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (FEnvQueryInstance<span style="color:#f92672">::</span>ItemIterator It(<span style="color:#66d9ef">this</span>, QueryInstance); It; <span style="color:#f92672">++</span>It)
</span></span><span style="display:flex;"><span>   {		
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   	<span style="color:#66d9ef">float</span> PlayerScore <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>   	<span style="color:#66d9ef">if</span>(AActor<span style="color:#f92672">*</span> ItemActor <span style="color:#f92672">=</span> GetItemActor(QueryInstance, It.GetIndex()))
</span></span><span style="display:flex;"><span>   	{
</span></span><span style="display:flex;"><span>   		PlayerScore <span style="color:#f92672">=</span> IAI_Interface<span style="color:#f92672">::</span>Execute_GetPlayerScore(ItemActor);
</span></span><span style="display:flex;"><span>   	}		
</span></span><span style="display:flex;"><span>   	It.SetScore(TestPurpose, FilterType, PlayerScore, MinThresholdValue, MaxThresholdValue);
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Further Information:</p>
<ul>
<li><a href="https://docs.unrealengine.com/5.1/en-US/environment-query-system-in-unreal-engine/">Unreal Documentation - EQS</a></li>
<li><a href="https://mercuna.com/writing-eqs-test/">Mercana - Writing EQS Test</a></li>
</ul>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Agent Arachnids Anthology 2025 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
