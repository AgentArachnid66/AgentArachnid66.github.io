<!doctype html>
<html lang="en-gb">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Custom EQS Test // Agent Arachnids Anthology</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.133.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Paul Brown" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css" />
    

    
  


    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Custom EQS Test">
  <meta name="twitter:description" content="EQS (Environment Query System) is a powerful tool when making an AI in Unreal Engine. Creating your own EQS Tests can open the way for more advanced interactions and more intelligent decision making.
In this tutorial, we will be making an EQS Test that can get a value from an actor using an interface.
EQS Test We will start by making a C&#43;&#43; Class:
Expand out the All Actors and search for EnvQueryTest">

    <meta property="og:url" content="http://localhost:1313/tutorials/custom-eqs-test/">
  <meta property="og:site_name" content="Agent Arachnids Anthology">
  <meta property="og:title" content="Custom EQS Test">
  <meta property="og:description" content="EQS (Environment Query System) is a powerful tool when making an AI in Unreal Engine. Creating your own EQS Tests can open the way for more advanced interactions and more intelligent decision making.
In this tutorial, we will be making an EQS Test that can get a value from an actor using an interface.
EQS Test We will start by making a C&#43;&#43; Class:
Expand out the All Actors and search for EnvQueryTest">
  <meta property="og:locale" content="en_gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tutorials">
    <meta property="article:published_time" content="2024-09-05T14:19:16+01:00">
    <meta property="article:modified_time" content="2024-09-05T14:19:16+01:00">


  </head>
  <body>
    <header class="app-header">
      
      <span class="app-header-title">Agent Arachnids Anthology</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/personal-projects/">Personal Projects</a>
             - 
          
          <a class="app-header-menu-item" href="/professional-projects/">Professional Projects</a>
             - 
          
          <a class="app-header-menu-item" href="/tutorials/">Tutorials</a>
             - 
          
          <a class="app-header-menu-item" href="/university-projects/">University Projects</a>
      </nav>
      <p>Lead Developer of Spyderweb Studios, and Multiplayer Technical Designer</p>
      <div class="app-header-social">
        
          <a href="https://github.com/agentarachnid66" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github Account</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://www.linkedin.com/in/paul-b-745268138/" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>LinkedIn</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
          <a href="https://www.youtube.com/@agentarachnid2009" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-youtube">
  <title>YouTube</title>
  <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Custom EQS Test</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Sep 5, 2024
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>EQS (Environment Query System) is a powerful tool when making an AI in Unreal Engine. Creating your own EQS Tests can open the way
for more advanced interactions and more intelligent decision making.</p>
<p>In this tutorial, we will be making an EQS Test that can get a value from an actor using an interface.</p>
<h2 id="eqs-test">EQS Test</h2>
<p>We will start by making a C++ Class:</p>
<p>Expand out the All Actors and search for <code>EnvQueryTest</code></p>
<p>Place this Class wherever you would like in your project and open it up.</p>
<p>In the <strong>header (.h)</strong> file we will only need 2 functions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UEQ_PlayerScore();
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RunTest</span>(FEnvQueryInstance<span style="color:#f92672">&amp;</span> QueryInstance) <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">override</span>;
</span></span></code></pre></div><p>We have here a constructor and a virtual function. Define these in the <strong>.cpp</strong> file and you should have this in that file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>UEQ_PlayerScore<span style="color:#f92672">::</span>UEQ_PlayerScore()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UEQ_PlayerScore<span style="color:#f92672">::</span>RunTest(FEnvQueryInstance<span style="color:#f92672">&amp;</span> QueryInstance) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The first thing that we need to define is what <code>Item</code> is going to be a valid type for this Test.</p>
<p>If you are wondering what an <code>Item</code> is, then it is basically what EQS spawns in and performs these Tests on to determine where
the final location is. They are created by the <a href="https://docs.unrealengine.com/5.1/en-US/eqs-node-reference-generators-in-unreal-engine/"><code>Generators</code></a>. There are essentially 2 types of item, Actor and Vector. We need to tell this test that we only care about the Actor base as we cannot run Interface functions on the Vectors.</p>
<p>To do this, we need a new include so at the top of the <strong>.cpp</strong> file, add:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;EnvironmentQuery/Items/EnvQueryItemType_ActorBase.h&#34;</span><span style="color:#75715e">
</span></span></span></code></pre></div><p>and in the constructor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>UEQ_PlayerScore<span style="color:#f92672">::</span>UEQ_PlayerScore()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ValidItemType <span style="color:#f92672">=</span> UEnvQueryItemType_ActorBase<span style="color:#f92672">::</span>StaticClass();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>That is all we need to do, so let&rsquo;s move onto the Test itself.</p>
<p>First we need to check if the Owner is valid so lets add that check to the <code>RunTest</code> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UEQ_PlayerScore<span style="color:#f92672">::</span>RunTest(FEnvQueryInstance<span style="color:#f92672">&amp;</span> QueryInstance) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//UDebugFunctionLibrary::DebugLog(&#34;Started Player Score Test&#34;, EDebugType::DT_Log);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	UObject<span style="color:#f92672">*</span> QueryOwner <span style="color:#f92672">=</span> QueryInstance.Owner.Get();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>IsValid(QueryOwner))
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now that we know that the Query Owner is valid, we can bind the Min and Max threshold values. Add this after the if statement. We want this to run if it does <strong>NOT</strong> return.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>    FloatValueMin.BindData(QueryOwner, QueryInstance.QueryID);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> MinThresholdValue <span style="color:#f92672">=</span> FloatValueMin.GetValue();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	FloatValueMax.BindData(QueryOwner, QueryInstance.QueryID);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> MaxThresholdValue <span style="color:#f92672">=</span> FloatValueMax.GetValue();
</span></span></code></pre></div><p>And finally, we can iterate over the Items. We are going to be adding in the Item Iterator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (FEnvQueryInstance<span style="color:#f92672">::</span>ItemIterator It(<span style="color:#66d9ef">this</span>, QueryInstance); It; <span style="color:#f92672">++</span>It)
</span></span><span style="display:flex;"><span>	{		
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">float</span> PlayerScore <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		It.SetScore(TestPurpose, FilterType, PlayerScore, MinThresholdValue, MaxThresholdValue);
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><p>The SetScore function has a few overloads, but for setting it based on a float and 2 threshold values this is one to use.</p>
<h2 id="interface">Interface</h2>
<p>After we have the Test setup, we can move onto the interface that we will be trying to call on the item actors.</p>
<p>Scroll to the bottom of the Common Classes and you&rsquo;ll find the Unreal Interface. Call it whatever you&rsquo;d like and open it up. For this example, we will just make one function
that returns a float value. It is important to mark it as a BlueprintNativeEvent.</p>
<p>In the I(InterfaceName) class, add in:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UFUNCTION(BlueprintNativeEvent, BlueprintCallable)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> GetPlayerScore();
</span></span></code></pre></div><p>Your Interface <strong>.h</strong> file should look something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">// This class does not need to be modified.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>UINTERFACE(MinimalAPI)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UAI_Interface</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> UInterface
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	GENERATED_BODY()
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ARTIFICIALINTELLIGENCESYSTEM_API</span> IAI_Interface
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	GENERATED_BODY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Add interface functions to this class. This is the class that will be inherited to implement this interface.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UFUNCTION(BlueprintNativeEvent, BlueprintCallable, Category<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;AI Interface&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> GetPlayerScore();
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="putting-it-all-together">Putting it all together</h2>
<p>Returning to the EQS Test, we need to add to the Item Iterator to actually run the Interface call.</p>
<p>Add the following to the <code>for loop</code> after declaring <code>PlayerScore</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(AActor<span style="color:#f92672">*</span> ItemActor <span style="color:#f92672">=</span> GetItemActor(QueryInstance, It.GetIndex()))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        PlayerScore <span style="color:#f92672">=</span> IAI_Interface<span style="color:#f92672">::</span>Execute_GetPlayerScore(ItemActor);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>So your final C++ RunTest function should look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UEQ_PlayerScore<span style="color:#f92672">::</span>RunTest(FEnvQueryInstance<span style="color:#f92672">&amp;</span> QueryInstance) <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{	
</span></span><span style="display:flex;"><span>   UObject<span style="color:#f92672">*</span> QueryOwner <span style="color:#f92672">=</span> QueryInstance.Owner.Get();
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>IsValid(QueryOwner))
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>   	<span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   FloatValueMin.BindData(QueryOwner, QueryInstance.QueryID);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">float</span> MinThresholdValue <span style="color:#f92672">=</span> FloatValueMin.GetValue();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   FloatValueMax.BindData(QueryOwner, QueryInstance.QueryID);
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">float</span> MaxThresholdValue <span style="color:#f92672">=</span> FloatValueMax.GetValue();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> (FEnvQueryInstance<span style="color:#f92672">::</span>ItemIterator It(<span style="color:#66d9ef">this</span>, QueryInstance); It; <span style="color:#f92672">++</span>It)
</span></span><span style="display:flex;"><span>   {		
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   	<span style="color:#66d9ef">float</span> PlayerScore <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>   	<span style="color:#66d9ef">if</span>(AActor<span style="color:#f92672">*</span> ItemActor <span style="color:#f92672">=</span> GetItemActor(QueryInstance, It.GetIndex()))
</span></span><span style="display:flex;"><span>   	{
</span></span><span style="display:flex;"><span>   		PlayerScore <span style="color:#f92672">=</span> IAI_Interface<span style="color:#f92672">::</span>Execute_GetPlayerScore(ItemActor);
</span></span><span style="display:flex;"><span>   	}		
</span></span><span style="display:flex;"><span>   	It.SetScore(TestPurpose, FilterType, PlayerScore, MinThresholdValue, MaxThresholdValue);
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Further Information:</p>
<ul>
<li><a href="https://docs.unrealengine.com/5.1/en-US/environment-query-system-in-unreal-engine/">Unreal Documentation - EQS</a></li>
<li><a href="https://mercuna.com/writing-eqs-test/">Mercana - Writing EQS Test</a></li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
